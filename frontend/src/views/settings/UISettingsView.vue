<template>
    <div class="ui-settings">
      <h2 class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h2>
      <p class="section-description">
        –ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å AIHub –ø–æ–¥ —Å–≤–æ–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è.
      </p>
      
      <div class="settings-sections">
        <div class="settings-section">
          <h3 class="subsection-title">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h3>
          
          <div class="setting-item">
            <div class="setting-info">
              <h4 class="setting-title">–¢–µ–º–∞</h4>
              <p class="setting-description">–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–µ—Ç–ª—É—é –∏–ª–∏ —Ç–µ–º–Ω—É—é —Ç–µ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.</p>
            </div>
            
            <div class="setting-control">
              <div class="theme-selector">
                <button 
                  class="theme-option" 
                  :class="{ 'active': selectedTheme === 'light' }" 
                  @click="setTheme('light')"
                >
                  <span class="theme-icon">‚òÄÔ∏è</span>
                  <span>–°–≤–µ—Ç–ª–∞—è</span>
                </button>
                
                <button 
                  class="theme-option" 
                  :class="{ 'active': selectedTheme === 'dark' }" 
                  @click="setTheme('dark')"
                >
                  <span class="theme-icon">üåô</span>
                  <span>–¢–µ–º–Ω–∞—è</span>
                </button>
                
                <button 
                  class="theme-option" 
                  :class="{ 'active': selectedTheme === 'system' }" 
                  @click="setTheme('system')"
                >
                  <span class="theme-icon">üñ•Ô∏è</span>
                  <span>–°–∏—Å—Ç–µ–º–Ω–∞—è</span>
                </button>
              </div>
            </div>
          </div>
          
          <div class="setting-item">
            <div class="setting-info">
              <h4 class="setting-title">–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞</h4>
              <p class="setting-description">–û—Ç—Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.</p>
            </div>
            
            <div class="setting-control">
              <div class="font-size-selector">
                <button 
                  class="font-size-option" 
                  :class="{ 'active': fontSize === 'small' }" 
                  @click="setFontSize('small')"
                >
                  A<sub>-</sub>
                </button>
                
                <button 
                  class="font-size-option" 
                  :class="{ 'active': fontSize === 'medium' }" 
                  @click="setFontSize('medium')"
                >
                  A
                </button>
                
                <button 
                  class="font-size-option" 
                  :class="{ 'active': fontSize === 'large' }" 
                  @click="setFontSize('large')"
                >
                  A<sup>+</sup>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <div class="settings-section">
          <h3 class="subsection-title">–ü–æ–≤–µ–¥–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h3>
          
          <div class="setting-item">
            <div class="setting-info">
              <h4 class="setting-title">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º</h4>
              <p class="setting-description">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞—Ç—å —á–∞—Ç –∫ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º.</p>
            </div>
            
            <div class="setting-control">
              <label class="toggle-switch">
                <input type="checkbox" v-model="autoScroll">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          
          <div class="setting-item">
            <div class="setting-info">
              <h4 class="setting-title">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏–π</h4>
              <p class="setting-description">–û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö (—Ç–æ–∫–µ–Ω—ã, —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Ç.–¥.).</p>
            </div>
            
            <div class="setting-control">
              <label class="toggle-switch">
                <input type="checkbox" v-model="showMessageMetadata">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          
          <div class="setting-item">
            <div class="setting-info">
              <h4 class="setting-title">–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º</h4>
              <p class="setting-description">–£–º–µ–Ω—å—à–∞–µ—Ç –æ—Ç—Å—Ç—É–ø—ã –∏ —Ä–∞–∑–º–µ—Ä—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.</p>
            </div>
            
            <div class="setting-control">
              <label class="toggle-switch">
                <input type="checkbox" v-model="compactMode">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
        
        <div class="settings-section">
          <h3 class="subsection-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
          
          <div class="setting-item">
            <div class="setting-info">
              <h4 class="setting-title">–í–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
              <p class="setting-description">–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∑–≤—É–∫ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.</p>
            </div>
            
            <div class="setting-control">
              <label class="toggle-switch">
                <input type="checkbox" v-model="soundNotifications">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          
          <div class="setting-item">
            <div class="setting-info">
              <h4 class="setting-title">–û–ø–æ–≤–µ—â–µ–Ω–∏—è –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤ API</h4>
              <p class="setting-description">–£–≤–µ–¥–æ–º–ª—è—Ç—å –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –ª–∏–º–∏—Ç–∞–º API –∫–ª—é—á–µ–π.</p>
            </div>
            
            <div class="setting-control">
              <label class="toggle-switch">
                <input type="checkbox" v-model="apiLimitAlerts">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </div>
      </div>
      
      <div class="settings-actions">
        <button @click="resetToDefaults" class="reset-button">–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        <button @click="saveSettings" class="save-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      </div>
      
      <div v-if="saveSuccess" class="success-message">
        –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!
      </div>
    </div>
  </template>
  
  <script setup>
  import { ref, onMounted } from 'vue';
  
  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  const selectedTheme = ref('light');
  const fontSize = ref('medium');
  const autoScroll = ref(true);
  const showMessageMetadata = ref(true);
  const compactMode = ref(false);
  const soundNotifications = ref(false);
  const apiLimitAlerts = ref(true);
  const saveSuccess = ref(false);
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ localStorage
  const loadSettings = () => {
    const settings = localStorage.getItem('ui-settings');
    if (settings) {
      const parsedSettings = JSON.parse(settings);
      selectedTheme.value = parsedSettings.theme || 'light';
      fontSize.value = parsedSettings.fontSize || 'medium';
      autoScroll.value = parsedSettings.autoScroll !== undefined ? parsedSettings.autoScroll : true;
      showMessageMetadata.value = parsedSettings.showMessageMetadata !== undefined ? parsedSettings.showMessageMetadata : true;
      compactMode.value = parsedSettings.compactMode || false;
      soundNotifications.value = parsedSettings.soundNotifications || false;
      apiLimitAlerts.value = parsedSettings.apiLimitAlerts !== undefined ? parsedSettings.apiLimitAlerts : true;
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
    applyTheme();
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
    applyFontSize();
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ä–µ–∂–∏–º
    applyCompactMode();
  };
  
  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
  const saveSettings = () => {
    const settings = {
      theme: selectedTheme.value,
      fontSize: fontSize.value,
      autoScroll: autoScroll.value,
      showMessageMetadata: showMessageMetadata.value,
      compactMode: compactMode.value,
      soundNotifications: soundNotifications.value,
      apiLimitAlerts: apiLimitAlerts.value
    };
    
    localStorage.setItem('ui-settings', JSON.stringify(settings));
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
    saveSuccess.value = true;
    
    // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
      saveSuccess.value = false;
    }, 3000);
  };
  
  // –°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  const resetToDefaults = () => {
    selectedTheme.value = 'light';
    fontSize.value = 'medium';
    autoScroll.value = true;
    showMessageMetadata.value = true;
    compactMode.value = false;
    soundNotifications.value = false;
    apiLimitAlerts.value = true;
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    applyTheme();
    applyFontSize();
    applyCompactMode();
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    saveSettings();
  };
  
  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–º—ã
  const setTheme = (theme) => {
    selectedTheme.value = theme;
    applyTheme();
  };
  
  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã
  const applyTheme = () => {
    let theme;
    
    if (selectedTheme.value === 'system') {
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é —Ç–µ–º—É
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      theme = prefersDark ? 'dark' : 'light';
    } else {
      theme = selectedTheme.value;
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  };
  
// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
const setFontSize = (size) => {
  fontSize.value = size;
  applyFontSize();
};

// –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
const applyFontSize = () => {
  const rootElement = document.documentElement;
  
  // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–ª–∞—Å—Å—ã —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
  rootElement.classList.remove('font-small', 'font-medium', 'font-large');
  
  // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å
  rootElement.classList.add(`font-${fontSize.value}`);
};

// –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
const applyCompactMode = () => {
  if (compactMode.value) {
    document.documentElement.classList.add('compact-mode');
  } else {
    document.documentElement.classList.remove('compact-mode');
  }
};

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
onMounted(() => {
  loadSettings();
  
  // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
    if (selectedTheme.value === 'system') {
      applyTheme();
    }
  });
});
</script>

<style scoped>
.ui-settings {
  max-width: 800px;
}

.section-title {
  margin-top: 0;
  margin-bottom: 0.75rem;
  font-size: 1.5rem;
  font-weight: 600;
}

.section-description {
  margin-bottom: 2rem;
  color: #6b7280;
}

.settings-sections {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.settings-section {
  padding-bottom: 2rem;
  border-bottom: 1px solid var(--border-color);
}

.settings-section:last-child {
  border-bottom: none;
}

.subsection-title {
  margin-top: 0;
  margin-bottom: 1.5rem;
  font-size: 1.25rem;
  font-weight: 600;
}

.setting-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.setting-item:last-child {
  margin-bottom: 0;
}

.setting-info {
  flex: 1;
  margin-right: 2rem;
}

.setting-title {
  margin: 0 0 0.25rem 0;
  font-size: 1rem;
  font-weight: 500;
}

.setting-description {
  margin: 0;
  font-size: 0.875rem;
  color: #6b7280;
}

/* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ —Ç–µ–º—ã */
.theme-selector {
  display: flex;
  gap: 0.5rem;
}

.theme-option {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0.75rem;
  border: 1px solid var(--border-color);
  border-radius: 0.5rem;
  background-color: var(--background-color);
  cursor: pointer;
}

.theme-option.active {
  border-color: var(--primary-color);
  background-color: rgba(59, 130, 246, 0.1);
}

.theme-icon {
  font-size: 1.5rem;
  margin-bottom: 0.5rem;
}

/* –í—ã–±–æ—Ä —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞ */
.font-size-selector {
  display: flex;
  gap: 0.5rem;
}

.font-size-option {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border: 1px solid var(--border-color);
  border-radius: 0.5rem;
  background-color: var(--background-color);
  cursor: pointer;
}

.font-size-option.active {
  border-color: var(--primary-color);
  background-color: rgba(59, 130, 246, 0.1);
}

/* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å */
.toggle-switch {
  position: relative;
  display: inline-block;
  width: 48px;
  height: 24px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #e5e7eb;
  transition: .4s;
  border-radius: 24px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .toggle-slider {
  background-color: var(--primary-color);
}

input:checked + .toggle-slider:before {
  transform: translateX(24px);
}

.settings-actions {
  display: flex;
  justify-content: flex-end;
  gap: 1rem;
  margin-top: 2rem;
}

.reset-button {
  padding: 0.75rem 1.5rem;
  background-color: #e5e7eb;
  color: #1f2937;
  border: none;
  border-radius: 0.25rem;
  font-weight: 500;
  cursor: pointer;
}

.save-button {
  padding: 0.75rem 1.5rem;
  background-color: var(--primary-color);
  color: white;
  border: none;
  border-radius: 0.25rem;
  font-weight: 500;
  cursor: pointer;
}

.success-message {
  margin-top: 1rem;
  padding: 0.75rem;
  background-color: rgba(16, 185, 129, 0.1);
  color: #065f46;
  border-radius: 0.25rem;
}
</style>